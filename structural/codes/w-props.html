<html>
  <head>
    <link rel="stylesheet" type="text/css" href="/css/amt.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script
      src="https://code.jquery.com/jquery-3.3.1.min.js"
      integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
      crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
      table {
        width: 100%;
        margin: auto;
      }

      td {
        padding: 0.5rem;
      }

      th {
        background-color: white;
      }

      select, input {
        font-size: 0.9rem;
        width: 6rem;
        border-radius: 0;
      }

      .cardContent h1 {
        font-size: 0.9rem;
        font-weight: 700;
        border-bottom: 1px solid black;
        margin: 0.75rem 0 0.75rem 0;
      }
      
      .cardHeader:after {
        content: "\2796"; /* Unicode character for "minus" sign (-) */
        font-size: 1rem;
        color: #777;
        float: right;
        margin-left: 5px;
      }

      .padding {
        padding: 1rem;
      }

      .result {
        font-size: 3rem;
        font-weight: 700;
        background-color: #f7f7f7;
        border-radius: 1rem;
        width: 90%;
        padding: 3rem;
        text-align: center;
      }
      
      .tableDesc {
        text-align: left;
      }
      
      .tableSymbol {
        text-align: right;
        white-space: nowrap;
        width: 4rem;
      }
      
      .tableValue {
        text-align: left;
        width: 6rem;
      }
    	    
      .tableUnits {
        text-align: left;
        font-size: 0.75rem;
        color: darkgray;
        max-width: 4rem;
      }

    </style>
  </head>
  <body onload="getData()">
    <div class="row">
      <div class="topnav" id="navbar"></div>
    </div>
    <div class="row" id="contentRow">
      <div class="card">
        <div class="cardHeader">
          AISC Beam-Column Design - W Shapes
        </div>
        <div class="cardContent">
          Computes axial (P), flexural (M), and combined axial and flexural (P-M) loading strength.  Uses AISC shapes database (version 15) and AISC 360-16.
        </div>
      </div>

      <div class="card">
        <div class="cardHeader">
          Input
        </div>
        <div class="cardContent">

            <h1>Member Properties</h1>
            <table>
              <tr>
                <td class="tableDesc">Section</td>
                <td></td>
                <td><select id="selectSection"></select></td>
                <td></td>
              </tr>
              <tr>
                <td class="tableDesc">Material</td>
                <td></td>
                <td>
                  <select id=“selectMaterial”>
                    <option value="A36">ASTM A36</option>
                    <option value="A992">ASTM A992</option>
                  </select>
                </td>
                <td></td>
              </tr>
              <tr>
                <td class="tableDesc">Member Length</td>
                <td class="tableSymbol">L =</td>
                <td class="tableValue"><input id="L" type="text" value=""></td>
                <td class="tableUnits">ft</td>
              </tr>
              <tr>
                <td class="tableDesc">Unbraced Length (Bending)</td>
                <td class="tableSymbol">L<sub>b</sub> =</td>
                <td class="tableValue"><input id="Lb" type="text" value=""></td>
                <td class="tableUnits">ft</td>
              </tr>
              <tr>
                <td class="tableDesc">Moment Gradient</td>
                <td class="tableSymbol">C<sub>b</sub> =</td>
                <td class="tableValue"><input id="Cb" type="text" value=""></td>
                <td>--</td>
              </tr>
              <tr>
                <td class="tableDesc">Effective Length Factor (Strong-Axis Buckling)</td>
                <td class="tableSymbol">K<sub>x</sub> =</td>
                <td class="tableValue"><input id="Kx" type="text" value=""></td>
                <td>--</td>
              </tr>
              <tr>
                <td class="tableDesc">Unbraced Length (Strong-Axis Buckling)</td>
                <td class="tableSymbol">L<sub>bx</sub> =</td>
                <td class="tableValue"><input id="Lbx" type="text" value=""></td>
                <td class="tableUnits">ft</td>
              </tr>
              <tr>
                <td class="tableDesc">Effective Length Factor (Weak-Axis Buckling)</td>
                <td class="tableSymbol">K<sub>y</sub> =</td>
                <td class="tableValue"><input id="Ky" type="text" value=""></td>
                <td>--</td>
              </tr>
              <tr>
                <td class="tableDesc">Unbraced Length (Weak-Axis Buckling)</td>
                <td class="tableSymbol">L<sub>by</sub> =</td>
                <td class="tableValue"><input id="Lby" type="text" value=""></td>
                <td class="tableUnits">ft</td>
              </tr>
            </table>

            <h1>Design Loads</h1>
              
            <table>
              <tr>
                <td class="tableDesc">Method</td>
                <td></td>
                <td>
                  <select id="selectMethod">
                    <option value="ASD">ASD</option>
                    <option value="LRFD">LRFD</option>
                  </select>
                </td>
		            <td></td>
              </tr>
              <tr>
                <td class="tableDesc">Required Axial Strength</td>
                <td class="tableSymbol">P<sub>r</sub> =</td>
                <td class="tableValue"><input id="Pr" type="text" value=""></td>
                <td class="tableUnits">kips</td>
              </tr>
              <tr>
                <td class="tableDesc">Required Flexural Strength (strong-axis)</td>
                <td class="tableSymbol">M<sub>rx</sub> =</td>
                <td class="tableValue"><input id="Mrx" type="text" value=""></td>
                <td class="tableUnits">ft-kips</td>
              </tr>
              <tr>
                <td class="tableDesc">Required Flexural Strength (weak-axis)</td>
                <td class="tableSymbol">M<sub>ry</sub> =</td>
                <td class="tableValue"><input id="Mry" type="text" value=""></td>
                <td class="tableUnits">ft-kips</td>
              </tr>
            </table>


        </div>
      </div>

      <div class="card">
        <div class="cardHeader">
          Design Summary
        </div>
        <div class="cardContent">
          <div class="result" id="designMoment">
          </div>
        </div>
      </div>

      <div class="card">
        <div class="cardHeader">
          Detailed Calculation
        </div>
        <div class="cardContent">
          <h1>Material Properties</h1>
          <table>
            <tr>
              <td class="tableDesc">Modulus of Elasticity</td>
              <td class="tableSymbol"><label for="E">E =</label></td>
              <td class="tableValue"><input id="E" type="text" value=""></td>
              <td class="tableUnits">ksi</td>
            </tr>
            <tr>
              <td class="tableDesc">Yield Stress</td>
              <td class="tableSymbol"><label for="Fy">F<sub>y</sub> =</label></td>
              <td class="tableValue"><input id="Fy" type="text" value=""></td>
              <td class="tableUnits">ksi</td>
            </tr>
          </table>
          <h1>Section Properties</h1>
          <table>
            <tr>
              <th></th>
              <th></th>
              <th>x</th>
              <th>y</th>
            </tr>
              <tr>
                <td class="tableDesc">Moment of Inertia (in<sup>4</sup>)</td>
                <td class="tableSymbol">I =</td>
                <td class="tableValue" id="Ix"></td>
                <td class="tableValue" id="Iy"></td>
              </tr>
              <tr>
                <td class="tableDesc">Section Modulus (in<sup>3</sup>)</td> 
                <td class="tableSymbol">S =</td>
                <td class="tableValue" id="Sx"></td>
                <td class="tableValue" id="Sy"></td>
              </tr>
              <tr>
                <td class="tableDesc">Area (in<sup>2</sup>)</td>
                <td class="tableSymbol">A =</td>
                <td class="tableValue" id="A"></td>
                <td></td>
              </tr>
              <tr>
                <td class="tableDesc">Radius of Gyration (in)</td>
                <td class="tableSymbol">r =</td>
                <td class="tableValue" id="rx"></td>
                <td class="tableValue" id="ry"></td>
              </tr>
          </table>
          <h1>Flexural Capacity</h1>
          <div id="beamCurve"></div>
          <div>
            <table>
		          <tr>
                <td class="tableDesc">Plastic Moment</td>
                <td class="tableSymbol">M<sub>p</sub> =</td>
                <td class="tableValue" id="Mp"></td>
                <td class="tableUnits">ft-kip</td>
              </tr>
              <tr>
                <td class="tableDesc">Yield Moment</td>
		            <td class="tableSymbol">M<sub>y</sub> =</td>
                <td class="tableValue" id="My"></td>
                <td class="tableUnits">ft-kips</td>
              </tr>
              <tr>
                <td class="tableDesc">Lower bound of inelastic LTB (0.7F<sub>y</sub>S<sub>x</sub>)</td>
		            <td class="tableSymbol">M<sub>r</sub> =</td>
                <td class="tableValue" id="Mr"></td>
                <td class="tableUnits">ft-kips</td>
              </tr>
              <tr>
                <td class="tableDesc">Limiting unbraced length for yielding</td>
                <td class="tableSymbol">L<sub>p</sub> =</td>
                <td class="tableValue" id="Lp"></td>
                <td class="tableUnits">ft</td>
              </tr>
              <tr>
                <td class="tableDesc">Limiting unbraced length for inelastic LTB</td>
                <td class="tableSymbol">L<sub>r</sub> =</td>
                <td id="Lr"></td>
                <td class="tableUnits">ft</td>
              </tr>
              <tr>
                <td class="tableDesc">Nominal Moment Capacity based on L<sub>b</sub></td>
                <td class="tableSymbol">M<sub>n</sub> =</td>
                <td class="tableValue" id="Mn"></td>
                <td class="tableUnits">ft-kip</td>
              </tr>
            </table>
            <h1>Axial Capacity</h1>
            <p>calcs</p>
            <p>calcs</p>
            <h1>Combined Axial-Flexural Capacity</h1>
            <p>calcs</p>
            <p>calcs</p>
          </div>
        </div>
      </div>
    </div>
    <div class="pageFooter" id="pageFooter"></div>
  </body>

  <script>
    $("#navbar").load("/navbar.html"); // load navbar from file
    $("#pageFooter").load("/footer.html"); // load footer from file

    google.charts.load('current', {'packages':['corechart']});

    // Define Global Variables
    var shapeLibrary = undefined; // JSON containing all shape data
    var sectionKeys = undefined; // array containing section keys
    var propertyKeys = undefined; // array containing seciton property keys

    var beam = {
      section : "W8X31",
      E: 29000, // ksi
      Fy: 50, // ksi
      L: 20, // ft
      Lb: 20, // ft
      Cb: 1,

      sectionProp: function(prop) {
        return shapeLibrary[this.section][prop];
      },

      My: function() {
        return this.Fy * this.sectionProp("Sx") / 12;
      },

      Mp: function() {
        return this.Fy * this.sectionProp("Zx") / 12;
      },

      Mr: function() {
        return 0.7 * this.My();
      },

      Lp: function() {
        return 1.76 * this.sectionProp("ry") * Math.sqrt(this.E / this.Fy) / 12;
      },

      Lr: function() {
        a = 0.7 * this.Fy / this.E;
        b = this.sectionProp("J") * 1 /
            (this.sectionProp("Sx") * this.sectionProp("ho"));
        return 1.95 * this.sectionProp("rts") / a *
            Math.sqrt(b + Math.sqrt(b * b + 6.76 * a * a)) / 12;
      },

      Mn: function(Lb) {
        Lr = this.Lr();
        Lp = this.Lp();
        Mp = this.Mp();
        Mr = this.Mr();
        Cb = this.Cb;

        if (Lb <= Lp) {
          result = Mp;
        }

        if (Lb > Lp && Lb <= Lr) {
          Mn = Cb * (Mp - (Mp - Mr) * (Lb - Lp) / (Lr - Lp));
          result = Math.min(Mn, Mp);
        }

        if (Lb > Lr) {
          a = Math.pow(Lb * 12 / this.sectionProp("rts"), 2);
          b = this.sectionProp("J") * 1 /
              (this.sectionProp("Sx") * this.sectionProp("ho"));
          Fcr = Cb * Math.pow(Math.PI, 2) * this.E / a *
                Math.sqrt(1 + 0.078 * b * a);
          Mn = Fcr * this.sectionProp("Sx") / 12;
          result = Math.min(Mn, Mp);
        }

        return result;
      },

      MnCurve: function() {
        Mp = this.Mp();
        Mr = this.Mr();
        Cb = this.Cb;
        E = this.E;
        Sx = this.sectionProp("Sx");
        J = this.sectionProp("J");
        ho = this.sectionProp("ho");
        Lp = this.Lp();
        Lr = this.Lr();
        rts = this.sectionProp("rts");

        CbCritical = Mp / Mr;

        if (Cb >= 1 && Cb <= CbCritical) {
          LpPrime = Lp + Mp * (1 - 1 / Cb) * (Lr - Lp) / (Mp - Mr);
        }

        if (Cb > CbCritical) {
			  a = Math.pow(12 * Mp / (Cb * Math.pow(Math.PI, 2) * E * Sx), 2);
          b = -0.078 * J * 1 / Sx / ho;
          c = -1;
          x = (-b + Math.sqrt(b * b -4 * a * c)) / (2 * a);
          LpPrime = rts * Math.sqrt(x) / 12;
        }


        if (Cb >= 1 && Cb <= CbCritical) {
          return [
            ["Lb", "Mn"],
            [0, beam.Mn(0)],
            [LpPrime, beam.Mn(LpPrime)],
            [Lr, beam.Mn(Lr)],
            [1.05 * Lr, beam.Mn(1.05 * Lr)],
            [1.10 * Lr, beam.Mn(1.10 * Lr)],
            [1.15 * Lr, beam.Mn(1.15 * Lr)],
            [1.20 * Lr, beam.Mn(1.20 * Lr)],
            [1.25 * Lr, beam.Mn(1.25 * Lr)],
            [1.30 * Lr, beam.Mn(1.30 * Lr)],
            [1.35 * Lr, beam.Mn(1.35 * Lr)],
            [1.40 * Lr, beam.Mn(1.40 * Lr)],
            [1.45 * Lr, beam.Mn(1.45 * Lr)],
            [1.50 * Lr, beam.Mn(1.50 * Lr)]
          ];
        }

        if (this.Cb > CbCritical) {
          return [
            ["Lb", "Mn"],
            [0, beam.Mn(0)],
            [LpPrime, beam.Mn(LpPrime)],
            [1.05 * LpPrime, beam.Mn(1.05 * LpPrime)],
            [1.10 * LpPrime, beam.Mn(1.10 * LpPrime)],
            [1.15 * LpPrime, beam.Mn(1.15 * LpPrime)],
            [1.20 * LpPrime, beam.Mn(1.20 * LpPrime)],
            [1.25 * LpPrime, beam.Mn(1.25 * LpPrime)],
            [1.30 * LpPrime, beam.Mn(1.30 * LpPrime)],
            [1.35 * LpPrime, beam.Mn(1.35 * LpPrime)],
            [1.40 * LpPrime, beam.Mn(1.40 * LpPrime)],
            [1.45 * LpPrime, beam.Mn(1.45 * LpPrime)],
            [1.50 * LpPrime, beam.Mn(1.50 * LpPrime)]
          ];
        }

      }
    };

    // Pull data from server and call function to build page elements
    function getData() {
      var url = "/data/aisc-shapes-database-v15-w.json";
      $.getJSON(url, function(data){
        shapeLibrary = data;
        sectionKeys = Object.keys(shapeLibrary);
        propertyKeys = Object.keys(shapeLibrary[sectionKeys[0]]);
        initializePage();
      });
    }

    function readPage() { // sets beam properties to values from HTML page
      beam.section = document.getElementById("selectSection").value;
      beam.E = document.getElementById("E").value;
      beam.Fy = document.getElementById("Fy").value;
      beam.L = document.getElementById("L").value;
      beam.Lb = document.getElementById("Lb").value;
      beam.Cb = document.getElementById("Cb").value;
    }

    function updatePage() { // sets HTML page values to beam properties
      document.getElementById("selectSection").value = beam.section;
      document.getElementById("E").value = beam.E;
      document.getElementById("Fy").value = beam.Fy;
      document.getElementById("L").value = beam.L;
      document.getElementById("Lb").value = beam.Lb;
      document.getElementById("Cb").value = beam.Cb;

      document.getElementById("Ix").innerHTML = beam.sectionProp("Ix");

      document.getElementById("Mr").innerHTML = beam.Mr().toFixed(1);
      document.getElementById("Lr").innerHTML = beam.Lr().toFixed(1);
      document.getElementById("My").innerHTML = beam.My().toFixed(1);
      document.getElementById("Mp").innerHTML = beam.Mp().toFixed(1);
      document.getElementById("Lp").innerHTML = beam.Lp().toFixed(1);
      document.getElementById("Mn").innerHTML = beam.Mn(beam.Lb).toFixed(1);
      document.getElementById("designMoment").innerHTML = beam.Mn(beam.Lb).toFixed(1);

      drawChart();
    }

    function refreshPage() {
      readPage();
      updatePage();
    }

    // Populate dropdown menu for selecting section
    function initializePage() {
      // Populate section select dropdown
      var select = document.getElementById("selectSection");
      for (var i = 0; i < sectionKeys.length; i++) {
        var option = document.createElement("option");
        option.value = sectionKeys[i];
        option.innerHTML = sectionKeys[i];
        select.appendChild(option);
      }

      // Add event listeners to trigger re-calc when inputs are changed
      select.setAttribute("onchange", "refreshPage()");
      document.getElementById("Fy").setAttribute("oninput", "refreshPage()");
      document.getElementById("L").setAttribute("oninput", "refreshPage()");
      document.getElementById("Lb").setAttribute("oninput", "refreshPage()");
      document.getElementById("Cb").setAttribute("oninput", "refreshPage()");

      updatePage();
      drawChart();
    }

    function drawChart() {

      var data = new google.visualization.arrayToDataTable(beam.MnCurve());
      var options = {
        backgroundColor: "#ffffff",
        title: "Beam Strength Curve",
        hAxis: {title: "Unbraced Length (ft)"},
        vAxis: {title: "Nominal Strength (ft-kip)"},
        legend: "none",
        lineWidth: 2,
        height: 400
      };
      var chart = new google.visualization.AreaChart(document.getElementById('beamCurve'));
      chart.draw(data, options);
    }

    // Build full table for all sections
    function buildFullTable() {

      //Build table and append to target div

      var tbl = document.createElement("table");
      var tblBody = document.createElement("tbody");
      var row = document.createElement("tr");
      var heading = document.createElement("th");
      var cell = document.createElement("td");
      var cellText = document.createTextNode("");

      //Build Header Row

      for (var i = 0; i < propertyKeys.length; i++) {
        heading = document.createElement("th");
        cellText = document.createTextNode(propertyKeys[i]);
        heading.appendChild(cellText);
        row.appendChild(heading);
      }

      tblBody.appendChild(row);

      //Build Data Rows

      for (var i = 0; i < sectionKeys.length; i++) {
        section = sectionKeys[i]
        row = document.createElement("tr");
        for (var j = 0; j < propertyKeys.length; j++) {
          property = propertyKeys[j]
          cell = document.createElement("td");
          cellText = document.createTextNode(shapeLibrary[section][property]);
          cell.appendChild(cellText);
          row.appendChild(cell);
        }

        tblBody.appendChild(row);
      }

      tbl.appendChild(tblBody);
      targetDiv.appendChild(tbl);
    }

    // Build table for currentSection
    function buildCurrentSectionTable() {

      var targetDiv = document.getElementById("sectionData");
      var tbl = document.createElement("table");
      var tblBody = document.createElement("tbody");

      //Build Data Rows
      for (var i = 0; i < propertyKeys.length; i++) {
        var propertyName = propertyKeys[i];
        var propertyValue = shapeLibrary[beam.section][propertyName];

        var row = document.createElement("tr");

        var labelCell = document.createElement("td");
        var labelText = document.createTextNode(propertyName);
        labelCell.appendChild(labelText);
        row.appendChild(labelCell);

        var valueCell = document.createElement("td");
        var valueText = document.createTextNode(propertyValue);
        valueCell.appendChild(valueText);
        row.appendChild(valueCell);

        tblBody.appendChild(row);
      }

      tbl.appendChild(tblBody);
      targetDiv.appendChild(tbl);
    }

    function update(section) {
      clear();
      beam.section = section;
      buildCurrentSectionTable();
      readPage();
      document.getElementById("My").value = shapeLibrary[beam.section].Sx * beam.Fy / 12;
    }

    function clear() {
      // var targetDivs = ["sectionSketch",
      //                   "sectionData",
      //                   "beamCurve",
      //                   "columnCurve",
      //                   "combinedCurve"];
      //
      // for (var i = 0; i < targetDivs.length; i++) {
      //   var currentDiv = document.getElementById(targetDivs[i]);
      //   var children = currentDiv.childNodes;
      //   for (var j = 0; j < children.length; j++) {
      //     currentDiv.removeChild(children[j]);
      //   }
      // }
    }

  </script>
</html>
